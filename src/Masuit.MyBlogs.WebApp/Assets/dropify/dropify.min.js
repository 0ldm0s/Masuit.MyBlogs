/*!
 * =============================================================
 * dropify v0.2.0 - Override your input files with style.
 * https://github.com/JeremyFagis/dropify
 *
 * (c) 2015 - Jeremy FAGIS <jeremy@fagis.fr> (http://fagis.fr)
 * =============================================================
 */
(function(n,t){typeof define=="function"&&define.amd?define(["jquery"],t):typeof exports=="object"?module.exports=t(require("jquery")):n.Dropify=t(n.$)})(this,function(n){function t(t,i){if(window.File&&window.FileReader&&window.FileList&&window.Blob){this.element=t;this.input=n(this.element);this.wrapper=null;this.preview=null;this.filenameWrapper=null;this.settings=n.extend(!0,{defaultFile:"",maxFileSize:0,messages:{"default":"Drag and drop a file here or click",replace:"Drag and drop or click to replace",remove:"Remove",error:"Sorry, this file is too large"},tpl:{wrap:'<div class="dropify-wrapper"><\/div>',message:'<div class="dropify-message"><span class="file-icon" /> <p>{{ default }}<\/p><\/div>',preview:'<div class="dropify-preview"><span class="dropify-render"><\/span><div class="dropify-infos"><div class="dropify-infos-inner"><p class="dropify-infos-message">{{ replace }}<\/p><\/div><\/div><\/div>',filename:'<p class="dropify-filename"><span class="file-icon"><\/span> <span class="dropify-filename-inner"><\/span><\/p>',clearButton:'<button type="button" class="dropify-clear">{{ remove }}<\/button>',error:'<p class="dropify-error">{{ error }}<\/p>'}},i,this.input.data());this.imgFileFormats=["png","jpg","jpeg","gif","bmp"];this.file=null;this.filename=null;this.isDisabled=!1;this.onChange=this.onChange.bind(this);this.clearElement=this.clearElement.bind(this);this.translate();this.createElements();this.setSize();this.input.on("change",this.onChange)}}var i="dropify";return t.prototype.onChange=function(){this.resetPreview();this.setFilename(this.input.val());this.readUrl(this.element)},t.prototype.createElements=function(){var i,t;if(this.input.wrap(n(this.settings.tpl.wrap)),this.wrapper=this.input.parent(),i=n(this.settings.tpl.message).insertBefore(this.input),n(this.settings.tpl.error).appendTo(i),this.isTouchDevice()===!0&&this.wrapper.addClass("touch-fallback"),this.input.attr("disabled")&&(this.isDisabled=!0,this.wrapper.addClass("disabled")),this.preview=n(this.settings.tpl.preview),this.preview.insertAfter(this.input),this.isDisabled===!1&&this.settings.disableRemove!==!0){this.clearButton=n(this.settings.tpl.clearButton);this.clearButton.insertAfter(this.input);this.clearButton.on("click",this.clearElement)}this.filenameWrapper=n(this.settings.tpl.filename);this.filenameWrapper.prependTo(this.preview.find(".dropify-infos-inner"));t=this.settings.defaultFile||"";t.trim()!=""&&(this.setFilename(t),this.setPreview(t))},t.prototype.readUrl=function(n){if(n.files&&n.files[0]){var t=new FileReader;this.file=n.files[0];this.checkFileSize()?(t.onload=function(n){this.setPreview(n.target.result,this.file.name)}.bind(this),t.readAsDataURL(this.file)):(this.wrapper.addClass("has-error"),this.resetPreview(),this.clearElement())}},t.prototype.setPreview=function(t){this.wrapper.removeClass("has-error").addClass("has-preview");var i=this.preview.children(".dropify-render");this.isImage()===!0?n("<img />").attr("src",t).appendTo(i):(n("<i />").attr("class","dropify-font-file").appendTo(i),n('<span class="dropify-extension" />').html(this.getFileType()).appendTo(i));this.preview.fadeIn()},t.prototype.resetPreview=function(){this.wrapper.removeClass("has-preview");var n=this.preview.children(".dropify-render");n.find(".dropify-extension").remove();n.find("i").remove();n.find("img").remove();this.preview.hide()},t.prototype.getFilename=function(n){var t=n.split("\\").pop();return t==n&&(t=n.split("/").pop()),n!=""?t:""},t.prototype.setFilename=function(n){var n=this.getFilename(n);this.filename=n;this.filenameWrapper.children(".dropify-filename-inner").html(n)},t.prototype.clearElement=function(){var t=n.Event("dropify.beforeClear"),i;this.input.trigger(t,[this]);t.result!==!1&&(this.file=null,this.input.val(""),this.resetPreview(),i=n.Event("dropify.afterClear"),this.input.trigger(i,[this]))},t.prototype.setSize=function(){this.settings.height&&this.wrapper.height(this.settings.height)},t.prototype.isTouchDevice=function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},t.prototype.getFileType=function(){return this.filename.split(".").pop().toLowerCase()},t.prototype.isImage=function(){return this.imgFileFormats.indexOf(this.getFileType())!="-1"?!0:!1},t.prototype.translate=function(){var n,t;for(n in this.settings.tpl)for(t in this.settings.messages)this.settings.tpl[n]=this.settings.tpl[n].replace("{{ "+t+" }}",this.settings.messages[t])},t.prototype.checkFileSize=function(){return this.maxFileSizeToByte()===0||this.file.size<=this.maxFileSizeToByte()?!0:!1},t.prototype.maxFileSizeToByte=function(){var n=0;if(this.settings.maxFileSize!==0){var t=this.settings.maxFileSize.slice(-1).toUpperCase(),i=1024,r=i*1024,u=r*1024;t==="K"?n=parseFloat(this.settings.maxFileSize)*i:t==="M"?n=parseFloat(this.settings.maxFileSize)*r:t==="G"&&(n=parseFloat(this.settings.maxFileSize)*u)}return n},n.fn[i]=function(r){return this.each(function(){n.data(this,"plugin_"+i)||n.data(this,"plugin_"+i,new t(this,r))}),this},t});