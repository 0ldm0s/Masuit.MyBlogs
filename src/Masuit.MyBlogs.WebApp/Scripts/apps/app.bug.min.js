angular.module("myApp",["tm.pagination"]).filter("htmlString",["$sce",function(n){return function(t){return n.trustAsHtml(t)}}]).controller("home",["$scope","$http","$timeout",function(n,t,i){var r,u;n.Issue={Level:0};r=JSON.parse(localStorage.getItem("user"));r&&(n.Issue.Name=r.NickName,n.Issue.Email=r.Email);window.UE&&(n.ue||(n.ue=UE.getEditor("editor",{toolbars:[["removeformat","fontsize","emotion","link","paragraph","simpleupload","justifyleft","justifyright","justifycenter","forecolor","lineheight",]],zIndex:1e6,initialFrameWidth:null})));t.post("/passport/getuserinfo",null).then(function(t){t.data.Success&&(n.user=t.data.Data)});t.post("/bug/getbuglevels",null).then(function(t){t.data.Success&&(n.BugLevels=t.data.Data)});n.paginationConf={currentPage:1,itemsPerPage:10,pagesLength:15,perPageOptions:[10,15,20,30,50,100],rememberPerPage:"perPageItems",onChange:function(){n.GetPageData()}};n.GetPageData=function(){t.post("/bug/pagedata",{page:n.paginationConf.currentPage,size:n.paginationConf.itemsPerPage,kw:n.kw}).then(function(t){n.paginationConf.totalItems=t.data.TotalCount;$("div[ng-table-pagination]").remove();n.Issues=t.data.Data;window.loadingDone()})};n.create=function(){layer.open({type:1,zIndex:20,title:"创建一个问题",area:(window.screen.width>540?540:window.screen.width)+"px",content:$("#bug-form"),end:function(){$("#bug-form").css("display","none")}});$(".layui-layer").insertBefore($(".layui-layer-shade"))};n.cancel=function(){layer.closeAll();setTimeout(function(){$("#bug-form").css("display","none")},500)};n.submit=function(i){if(window.loading(),i.Description=n.ue.getContent(),i.Name&&i.Name.trim().length>17){window.notie.alert({type:4,text:"名字不能为空或者超出16个字符！",time:4});loadingDone();return}if(i.Email&&!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(i.Email.trim())){window.notie.alert({type:3,text:"请输入正确的邮箱格式！",time:4});loadingDone();return}if(i.Title&&!i.Title.trim()){window.notie.alert({type:3,text:"主题不能为空！",time:4});loadingDone();return}if(i.Link&&!i.Link.trim()){window.notie.alert({type:3,text:"链接不能为空！",time:4});loadingDone();return}if(i.Description&&!i.Description.trim()){window.notie.alert({type:3,text:"问题描述不能为空！",time:4});loadingDone();return}i.__RequestVerificationToken=$('[name="__RequestVerificationToken"]').val();t.post("/bug/submit",i,{"Content-Type":"application/x-www-form-urlencoded"}).then(function(t){var i=t.data;i.Success?(window.notie.alert({type:1,text:i.Message,time:4}),n.Issue={Level:0},n.GetPageData(),n.cancel()):window.notie.alert({type:3,text:i.Message,time:4});loadingDone()},function(){window.notie.alert({type:3,text:"服务请求失败！",time:4});loadingDone()})};n.search=function(t){u&&i.cancel(u);u=i(function(){n.kw=t;n.GetPageData();u=null},500)};n.handle=function(i){layer.prompt({title:"输入反馈留言",formType:2},function(r,u){layer.close(u);window.loading();t.post("/bug/handle",{id:i,text:r}).then(function(t){var i=t.data;i.Success?(layer.msg(i.Message),n.GetPageData(),n.cancel()):n.loadingDone()},function(){window.notie.alert({type:3,text:"服务请求失败！",time:4});n.loadingDone()})})};n.delete=function(i){layer.confirm("确认删除这个问题？",{btn:["确定","取消"]},function(){t.post("/bug/delete",{id:i}).then(function(t){var i=t.data;i.Success?(layer.msg(i.Message),n.GetPageData(),n.cancel()):n.loadingDone()},function(){window.notie.alert({type:3,text:"服务请求失败！",time:4});n.loadingDone()})},function(){})}}]);