@using Models.DTO
@model List<Models.Entity.PostHistoryVersion>
@{
    var post = (PostOutputDto)ViewBag.Primary;
    ViewBag.Title = post.Title+"的历史版本";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container">
    <ol class="cd-breadcrumb triangle">
        <li>@Html.ActionLink("首页", "Index", "Home")</li>
        <li>@Html.ActionLink("文章列表", "Post", "Home")</li>
        <li>@Html.ActionLink(post.Title.Length > 40 ? post.Title.Substring(0, 40) + "..." : post.Title, "Details", "Post", new { id = post.Id }, null)</li>
        <li class="current"><em>历史版本</em></li>
    </ol>
    <table class="table table-condensed table-bordered table-responsive">
        <thead>
            <tr>
                <th style="text-align: center">
                    <button class="btn btn-info btn-sm disabled" id="compare">版本对比</button>
                </th>
                <th>标题</th>
                <th>原分类</th>
                <th>修改时间</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align: center">
                    <input type="checkbox" name="vers" id="0"/>
                </td>
                <td>
                    @Html.ActionLink(post.Title, "Details", "Post", new { id = post.Id }, null) (最新版本)
                </td>
                <td>
                    @Html.ActionLink(post.CategoryName, "Category", "Home", new { id = post.CategoryId }, null)
                </td>
                <td>@post.ModifyDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
            </tr>
            @foreach (var p in Model)
            {
                <tr>
                    <td style="text-align: center">
                        <input type="checkbox" name="vers" id="@p.Id"/>
                    </td>
                    <td>
                        @Html.ActionLink(p.Title, "HistoryVersion", "Post", new { id = p.PostId, hid = p.Id }, null)
                    </td>
                    <td>
                        @Html.ActionLink(p.Category.Name, "Category", "Home", new { id = post.CategoryId }, null)
                    </td>
                    <td>@p.ModifyDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
                </tr>
            }
        </tbody>
    </table>
    <div class="col-md-12 text-center">
        @{ Html.RenderPartial("_Pagination"); }
    </div>
</div>
<script>
    $(function() {
		$("input[name='vers']").on("click", function(e) {
            if ($("input[name='vers']:checked").length >= 2) {
                $("#compare").removeClass("disabled");
            } else {
                $("#compare").addClass("disabled");
			}
			if ($("input[name='vers']:checked").length >= 3) {
				$("input[name='vers']:checked:eq(1)").prop('checked', false);
           } else {
                //$("input[name='vers']").prop('checked', false);
           }
		});
        $("#compare").on("click", function(e) {
			var arr = $("input[name='vers']:checked");
			location.href="/@post.Id/history/"+$(arr[0]).attr("id")+"-"+$(arr[1]).attr("id");
		});
	})
</script>