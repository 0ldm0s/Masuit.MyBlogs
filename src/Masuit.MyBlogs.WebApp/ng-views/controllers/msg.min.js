myApp.controller("msg",["$scope","$http","NgTableParams","$timeout",function(n,t,i){window.hub.disconnect();var r=this;n.loading();n.currentPage=1;n.paginationConf={currentPage:n.currentPage||1,itemsPerPage:10,pagesLength:25,perPageOptions:[1,5,10,15,20,30,40,50,100,200],rememberPerPage:"perPageItems",onChange:function(){r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)}};this.GetPageData=function(u,f){n.loading();t.post("/msg/GetPendingMsgs",{page:u,size:f}).then(function(t){n.paginationConf.totalItems=t.data.TotalCount;$("div[ng-table-pagination]").remove();r.tableParams=new i({count:5e4},{filterDelay:0,dataset:t.data.Data});n.loadingDone()})};r.del=function(t){swal({title:"确认删除这条留言吗？",text:t.Title,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1}).then(function(){n.request("/msg/delete",{id:t.Id},function(n){window.notie.alert({type:1,text:n.Message,time:4})});_.remove(r.tableParams.settings().dataset,function(n){return t===n});r.tableParams.reload().then(function(n){n.length===0&&r.tableParams.total()>0&&(r.tableParams.page(r.tableParams.page()-1),r.tableParams.reload())})},function(){}).catch(swal.noop)};r.pass=function(t){n.request("/msg/pass",t,function(t){window.notie.alert({type:1,text:t.Message,time:4});r.stats=[];r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)})};n.loadingDone()}]);myApp.controller("msgs",["$scope","$http","$timeout",function(n,t){window.hub.disconnect();var i=this;n.loading();n.currentPage=1;n.paginationConf={currentPage:n.currentPage||1,itemsPerPage:10,pagesLength:25,perPageOptions:[1,5,10,15,20,30,40,50,100,200],rememberPerPage:"perPageItems",onChange:function(){i.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)}};this.GetPageData=function(i,r){n.loading();t.post("/msg/GetInternalMsgs",{page:i,size:r}).then(function(t){n.paginationConf.totalItems=t.data.TotalCount;n.Messages=t.data.Data;n.loadingDone()})};n.MarkRead=function(){var r=_.max(n.Messages,n=>n.Id).Id;t.post("/msg/MarkRead",{id:r}).then(function(t){var r=t.data;r.Success&&i.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)})};n.toggleRead=function(n,i){i?t.post("/msg/read",{id:n}).then(function(){}):t.post("/msg/unread",{id:n}).then(function(){})};n.clearMsgs=function(){swal({title:"确定清除已读消息?",text:"即将彻底清除已读消息，不可恢复!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定!",cancelButtonText:"取消",preConfirm:function(){return new Promise(function(n){t.post("/msg/ClearMsgs").then(function(t){var i=t.data;n(i)})})},allowOutsideClick:!1}).then(function(t){t.Success&&i.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)}).catch(swal.noop)}}]);