function getFile(n,t){var i=$(n).val();console.log(i);$("input[name='"+t+"']").val(i)}function transData(n,t,i,r){for(var h=[],c={},a=t,v=i,f=r,o=0,s=0,l=n.length,u,e;o<l;o++)c[n[o][a]]=n[o];for(;s<l;s++)u=n[s],e=c[u[v]],e?(e[f]||(e[f]=[]),u[f]=[],e[f].push(u)):(u[f]=[],h.push(u));return h}myApp.controller("main",["$timeout","$state","$scope","$http",function(n,t,i,r){window.hub={disconnect:function(){}};i.post={};Waves.init();iziToast.settings({timeout:15e3,pauseOnHover:!0,close:!0,progressBar:!0});ifvisible.blur(function(){$("body").animate({opacity:.5},100)});ifvisible.wakeup(function(){$("body").animate({opacity:1},100)});localStorage.setItem("ma-layout-status",1);/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&angular.element("html").addClass("ismobile");Highcharts.setOptions({global:{timezoneOffset:0},colors:["#058DC7","#50B432","#ED561B","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4","#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#d95548","#9E0E9E","#6f7D8B","#0aaaea","#f7aa67","#e1622f","#fd7d36"," #fe9778","#ff9b6a","#f3d64e","#f1b8e4","#d9b8f1"," #f1ccb8","#f1f1b8","#b8f1ed","#b8f1cc","#CDDC39","#e7dac9","#FFC107","#FF9800","#fa7497","#f9b747","#dcff93","#b7d28d"," #f2debd","#b7d28d"]});this.sidebarToggle={left:!1,right:!1};this.layoutType=localStorage.getItem("ma-layout-status");this.$state=t;this.sidebarStat=function(n){angular.element(n.target).parent().hasClass("active")||(this.sidebarToggle.left=!1)};this.listviewSearchStat=!1;this.lvSearch=function(){this.listviewSearchStat=!0};this.lvMenuStat=!1;this.wallCommenting=[];this.wallImage=!1;this.wallVideo=!1;this.wallLink=!1;this.currentSkin="blue";this.skinList=["lightblue","bluegray","cyan","teal","green","orange","blue","purple"];this.skinSwitch=function(n){this.currentSkin=n};this.openSearch=function(){angular.element("#header").addClass("search-toggled");angular.element("#top-search-wrap").find("input").focus()};this.closeSearch=function(){angular.element("#header").removeClass("search-toggled")};this.clearNotification=function(t){t.preventDefault();r.post("/msg/MarkRead",{id:_.max(i.InternalMsgs,n=>n.Id).Id}).then(function(r){var o=r.data,e;if(o.Success){var u=angular.element(t.target).closest(".listview"),f=u.find(".lv-item"),s=f.length;angular.element(t.target).parent().fadeOut();u.find(".list-group").prepend('<i class="grid-loading hide-it"><\/i>');u.find(".grid-loading").fadeIn(1500);e=0;f.each(function(){var t=$(this);n(function(){t.addClass("animated fadeOutRightBig").delay(1e3).queue(function(){t.remove()})},e+=150)});n(function(){angular.element("#notifications").addClass("empty");i.InternalMsgs.length=0},s*150+200)}})};this.clearLocalStorage=function(){swal({title:"清除网站缓存?",text:"网站缓存即将被清除",type:"warning",showCancelButton:!0,showCloseButton:!0,confirmButtonColor:"#F44336",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:!1}).then(function(){localStorage.clear();swal("清除成功","网站缓存已经被清除","success")}).catch(swal.noop)};this.fullScreen=function(){function n(n){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}function t(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}t()?n(document.documentElement):n(document.documentElement)};i.isloading=!1;i.loading=function(){if(!i.isloading){i.isloading=!0;let n=(new Date).getMilliseconds();$(".loading"+(n%2+1)).show()}};i.loadingDone=function(){i.isloading=!1;$(".loading1").hide();$(".loading2").hide()};r.post("/passport/getuserinfo",null).then(function(n){n.data.Success&&(i.user=n.data.Data)});i.request=function(n,t,u,f){i.loading();r.post(n,t,{"Content-Type":"application/x-www-form-urlencoded"}).then(function(n){i.loadingDone();n.data.Success&&n.data.IsLogin?u(n.data):(f?f(n.data):window.notie.alert({type:3,text:n.data.Message,time:4}),i.CheckLogin(n.data))},function(){window.notie.alert({type:3,text:"服务请求失败！",time:4});i.loadingDone()})};this.request=i.request;i.CheckLogin=function(n){n.IsLogin||(window.location.href="/passport/login")};this.CheckLogin=i.CheckLogin;this.getmsg=function(){i.request("/dashboard/getmessages",null,function(n){i.Msgs=n.Data;n.Data.post.length>0&&iziToast.info({title:"待审核文章",message:"有"+n.Data.post.length+"篇新文章待审核哦!",position:"topRight",transitionIn:"bounceInRight"});n.Data.msgs.length>0&&iziToast.info({title:"待审核留言",message:"有"+n.Data.msgs.length+"条新留言待审核哦!",position:"topRight",transitionIn:"bounceInRight"});n.Data.comments.length>0&&iziToast.info({title:"待审核文章评论",message:"有"+n.Data.comments.length+"条新文章评论待审核哦!",position:"topRight",transitionIn:"bounceInRight"})});r.post("/msg/GetUnreadMsgs").then(function(n){i.InternalMsgs=n.data.Data;i.InternalMsgs.length>0&&iziToast.info({title:"未读消息",message:"有"+i.InternalMsgs.length+"条未读消息!",position:"topRight",transitionIn:"bounceInRight"})})};this.getmsg();i.read=function(n){r.post("/msg/read",{id:n}).then(function(){})};i.changeUsername=function(){swal({title:"请输入新的用户名",input:"text",inputPlaceholder:"请输入用户名",showCloseButton:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",inputValue:i.user.Username,inputValidator:function(n){return new Promise(function(t,i){n?t():i("用户名不能为空")})}}).then(function(n){n&&(i.user.Username=n,i.request("/user/changeUsername",{id:i.user.Id,username:n},function(n){swal({type:"success",html:n.Message})}))}).catch(swal.noop)};i.changeNickname=function(){swal({title:"请输入新的昵称",input:"text",inputPlaceholder:"请输入昵称",showCloseButton:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",inputValue:i.user.NickName,inputValidator:function(n){return new Promise(function(t,i){n?t():i("昵称不能为空")})}}).then(function(n){n&&(i.user.NickName=n,i.request("/user/changeNickname",{id:i.user.Id,username:n},function(n){swal({type:"success",html:n.Message})}))}).catch(swal.noop)};i.changeAvatar=function(){swal({title:"请选择一张图片作为新头像",input:"file",showCloseButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1,inputAttributes:{accept:"image/*"},preConfirm:function(n){return new Promise(function(t,u){if(n){var f=new FileReader;f.onload=function(n){swal({title:"上传预览",text:"确认后将开始上传并应用设置！",imageUrl:n.target.result,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"开始上传",cancelButtonText:"取消",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(t){r.post("/upload/DecodeDataUri",{data:n.target.result}).then(function(n){t(n.data)})})}}).then(function(n){n.Success?r.post("/user/changeavatar",{id:i.user.Id,path:n.Data}).then(function(i){t([n,i.data])},function(n){u("请求失败，错误码："+n.status)}):u(n.Message)},function(n){u("请求失败，错误码："+n.status)}).catch(swal.noop)};f.readAsDataURL(n)}else u("请选择图片")})},inputValidator:function(n){return new Promise(function(t,i){n?t():i("请选择图片")})}}).then(function(n){i.$apply(function(){i.user.Avatar=n[0].Data});swal(n[1].Message,"","success")}).catch(swal.noop)};i.changePassword=function(){swal({title:"修改密码",html:'<div class="input-group"><span class="input-group-addon"> 旧  密  码： <\/span><input id="old" type="password" class="form-control input-lg" autofocus placeholder="请输入旧密码"><\/div><div class="input-group"><span class="input-group-addon"> 新  密  码： <\/span><input id="new1" type="password" class="form-control input-lg" placeholder="请输入新密码"><\/div><div class="input-group"><span class="input-group-addon">确认新密码：<\/span><input id="new2" type="password" class="form-control input-lg" placeholder="请确认新密码"><\/div>',showCloseButton:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(n,t){var u=$("#old").val(),f=$("#new1").val(),e=$("#new2").val();r.post("/user/changepassword",{id:i.user.Id,old:u,pwd:f,pwd2:e}).then(function(i){i.data.Success?n(i.data.Message):t(i.data.Message)},function(){t("操作失败")})})}}).then(function(n){n&&swal(n,"","success")}).catch(swal.noop)};i.logout=function(){swal({title:"确认退出系统吗？",text:"您将退出管理系统并不再自动登录",type:"warning",showCancelButton:!0,showCloseButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确认",cancelButtonText:"取消",preConfirm:function(){return new Promise(function(n,t){r.post("/passport/logout",null).then(function(i){i.data.Success?n():t("退出登录失败！")})})}}).then(function(){setTimeout(function(){window.location.href="/"},2e3);swal("退出成功","即将返回网站首页","success")}).catch(swal.noop)}}]);Date.prototype.Format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};