var Custombox=function(n,t,i){"use strict";var r={create:document.createElement,settings:[],overlay:[],wrapper:[],container:[],modal:[],content:[],inline:[],size:[],close:[],open:[],scroll:[],display:[],item:-1},o={target:null,id:null,cache:!1,escKey:!0,zIndex:"auto",overlay:!0,overlayColor:"#000",overlayOpacity:.8,overlayClose:!0,overlaySpeed:300,overlayEffect:"auto",width:null,effect:"fadein",position:"center, center",animation:null,speed:500,open:null,complete:null,close:null},u={oldIE:navigator.appVersion.indexOf("MSIE 8.")>-1||navigator.appVersion.indexOf("MSIE 9.")>-1,oldMobile:/(iPhone|iPad|iPod)\sOS\s6/.test(navigator.userAgent),overlay:{perspective:["letmein","makeway","slip"],together:["corner","slidetogether","scale","door","push","contentscale","simplegenie","slit","slip"]},modal:{position:["slide","flip","rotate"]}},f={init:function(){this.merge().built().check().binds()},merge:function(){return r.settings.push(e.extend({},o,r.options)),delete r.options,r.item=r.settings.length-1,r.settings[r.item].overlayEffect==="auto"&&(r.settings[r.item].overlayEffect=r.settings[r.item].effect),this},built:function(){var f=e.zIndex();if(i.classList.add("custombox-open"),i.classList.add("custombox-open-"+r.settings[r.item].overlayEffect),u.overlay.perspective.indexOf(r.settings[r.item].overlayEffect)>-1&&(r.scroll.push(i&&i.scrollTop||t.body&&t.body.scrollTop||0),i.classList.add("custombox-perspective"),n.scrollTo(0,0)),!r.item){for(r.main=r.create.call(t,"div");t.body.firstChild;)r.main.appendChild(t.body.firstChild);t.body.appendChild(r.main)}return r.settings[r.item].overlayEffect==="push"&&(r.main.style.transitionDuration=r.settings[r.item].speed+"ms"),r.main.classList.add("custombox-container"),r.main.classList.add("custombox-container-"+r.settings[r.item].overlayEffect),r.settings[r.item].overlay?(r.overlay.push(r.create.call(t,"div")),r.overlay[r.item].classList.add("custombox-overlay"),r.overlay[r.item].classList.add("custombox-overlay-"+r.settings[r.item].overlayEffect),r.overlay[r.item].style.zIndex=f+2,r.overlay[r.item].style.backgroundColor=r.settings[r.item].overlayColor,r.overlay[r.item].dataset.custombox=r.settings[r.item].id,u.overlay.perspective.indexOf(r.settings[r.item].overlayEffect)>-1||u.overlay.together.indexOf(r.settings[r.item].overlayEffect)>-1?r.overlay[r.item].style.opacity=r.settings[r.item].overlayOpacity:r.overlay[r.item].classList.add("custombox-overlay-default"),r.overlay[r.item].style.transitionDuration=u.overlay.together.indexOf(r.settings[r.item].overlayEffect)>-1?r.settings[r.item].speed+"ms":r.settings[r.item].overlaySpeed+"ms",t.body.insertBefore(r.overlay[r.item],t.body.lastChild.nextSibling)):r.overlay.push(null),r.wrapper.push(r.create.call(t,"div")),r.wrapper[r.item].classList.add("custombox-modal-wrapper"),r.wrapper[r.item].classList.add("custombox-modal-wrapper-"+r.settings[r.item].effect),r.wrapper[r.item].style.zIndex=f+3,r.wrapper[r.item].dataset.custombox=r.settings[r.item].id,t.body.insertBefore(r.wrapper[r.item],t.body.lastChild.nextSibling),r.container.push(r.create.call(t,"div")),r.container[r.item].classList.add("custombox-modal-container"),r.container[r.item].classList.add("custombox-modal-container-"+r.settings[r.item].effect),r.container[r.item].style.zIndex=f+4,u.modal.position.indexOf(r.settings[r.item].effect)>-1&&(r.settings[r.item].animation=r.settings[r.item].animation!==null?r.settings[r.item].animation.indexOf(",")>-1?r.settings[r.item].animation.split(","):[r.settings[r.item].animation]:r.settings[r.item].effect==="slide"?["top"]:r.settings[r.item].effect==="flip"?["horizontal"]:["bottom"]),r.modal.push(r.create.call(t,"div")),r.modal[r.item].classList.add("custombox-modal"),r.modal[r.item].classList.add("custombox-modal-"+r.settings[r.item].effect+(u.modal.position.indexOf(r.settings[r.item].effect)>-1?"-"+r.settings[r.item].animation[0].trim():"")),r.modal[r.item].style.transitionDuration=r.settings[r.item].speed+"ms",r.modal[r.item].style.zIndex=f+4,r.wrapper[r.item].appendChild(r.container[r.item]).appendChild(r.modal[r.item]),this},check:function(){if(typeof r.settings[r.item].open=="function"&&r.settings[r.item].open.call(),t.createEvent){var n=t.createEvent("Event");n.initEvent("custombox.open",!0,!0);t.dispatchEvent(n)}return r.settings[r.item].position.indexOf(",")>-1?(r.settings[r.item].position=r.settings[r.item].position.split(","),r.settings[r.item].target.charAt(0)==="#"||r.settings[r.item].target.charAt(0)==="."&&r.settings[r.item].target.charAt(1)!=="/"?t.querySelector(r.settings[r.item].target)?(r.inline.push(r.create.call(t,"div")),r.content.push(t.querySelector(r.settings[r.item].target)),r.display.push(r.content[r.item].style.display==="none"),r.content[r.item].style.display="block",r.content[r.item].parentNode.insertBefore(r.inline[r.item],r.content[r.item]),this.size().open()):this.error():this.ajax()):this.error(),this},ajax:function(){var i=this,n=new XMLHttpRequest,f=r.create.call(t,"div");n.onreadystatechange=function(){n.readyState===4&&(n.status===200?(f.innerHTML=n.responseText,r.content.push(f),r.content[r.item].style.display="block",u.oldIE?r.content[r.item].style.styleFloat="left":r.content[r.item].style.cssFloat="left",r.container[r.item].appendChild(r.content[r.item]),i.size().open()):i.error())};n.open("GET",r.settings[r.item].target+(r.settings[r.item].cache?"":(/[?].+=/.test(r.settings[r.item].target)?"&_=":"?_=")+Date.now()),!0);n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(null)},size:function(){var e,f;if(u.oldIE&&(n.innerHeight=i.clientHeight),e=r.content[r.item].offsetWidth,r.inline[r.item]||(u.oldIE?r.content[r.item].style.styleFloat="none":r.content[r.item].style.cssFloat="none"),isNaN(r.settings[r.item].width)||r.settings[r.item].width===null||(e=parseInt(r.settings[r.item].width,0)),r.size.push(e),r.size[r.item]+60>=n.innerWidth){r.container[r.item].style.width="auto";r.container[r.item].style.margin="5%";r.wrapper[r.item].style.width=n.innerWidth+"px";for(var t=0,o=r.content[r.item].querySelectorAll(":scope > *"),s=o.length;t<s;t++)o[t].offsetWidth>n.innerWidth&&(o[t].style.width="auto")}else{switch(r.settings[r.item].position[0].trim()){case"left":r.container[r.item].style.marginLeft=0;break;case"right":r.container[r.item].style.marginRight=0}r.container[r.item].style.width=r.size[r.item]+"px"}if(r.content[r.item].style.width="auto",r.modal[r.item].appendChild(r.content[r.item]),r.content[r.item].offsetHeight>=n.innerHeight)r.container[r.item].style.marginTop="5%",r.container[r.item].style.marginBottom="5%";else{switch(r.settings[r.item].position[1].trim()){case"top":f=0;break;case"bottom":f=n.innerHeight-r.content[r.item].offsetHeight+"px";break;default:f=n.innerHeight/2-r.content[r.item].offsetHeight/2+"px"}r.container[r.item].style.marginTop=f}return this},open:function(){if(r.settings[r.item].overlay)if(u.overlay.perspective.indexOf(r.settings[r.item].overlayEffect)>-1||u.overlay.together.indexOf(r.settings[r.item].overlayEffect)>-1?r.overlay[r.item].classList.add("custombox-overlay-open"):r.overlay[r.item].style.opacity=r.settings[r.item].overlayOpacity,r.main.classList.add("custombox-container-open"),u.overlay.together.indexOf(r.settings[r.item].overlayEffect)>-1||u.oldIE)r.wrapper[r.item].classList.add("custombox-modal-open");else{var n=function(){r.overlay[r.item].removeEventListener("transitionend",n);r.wrapper[r.item].classList.add("custombox-modal-open")};r.overlay[r.item].addEventListener("transitionend",n,!1)}else r.wrapper[r.item].classList.add("custombox-modal-open"),r.main.classList.add("custombox-container-open");return this},binds:function(){var f=this,e,i;r.settings[r.item].escKey&&(t.onkeydown=function(t){t=t||n.event;t.keyCode===27&&f.close()});r.settings[r.item].overlayClose&&r.wrapper[r.item].addEventListener("click",function(n){n.target===r.wrapper[r.item]&&f.close()},!1);n.addEventListener("onorientationchange"in n?"orientationchange":"resize",function(){f.responsive()},!1);e=function(){var i;if(!r.inline[r.item])for(var n=0,u=r.modal[r.item].getElementsByTagName("script"),f=u.length;n<f;n++)new Function(u[n].text)();r.settings[r.item]&&typeof r.settings[r.item].complete=="function"&&r.settings[r.item].complete.call();t.createEvent&&(i=t.createEvent("Event"),i.initEvent("custombox.complete",!0,!0),t.dispatchEvent(i))};i=function(){e();r.modal[r.item].removeEventListener("transitionend",i)};u.oldIE||u.oldMobile?setTimeout(function(){e()},r.settings[r.item].overlaySpeed):r.settings[r.item].effect!=="slit"?r.modal[r.item].addEventListener("transitionend",i,!1):r.modal[r.item].addEventListener("animationend",i,!1)},close:function(f){var e,o,l,s,h,c;if(f==="first")e=0;else if(typeof f!="undefined"){for(o=0,l=r.settings.length;o<l;o++)if(r.settings[o].id==f){e=o;break}e===undefined&&(e=r.settings.length-1)}else e=r.settings.length-1;s=function(){if(i.classList.remove("custombox-open-"+r.settings[e].overlayEffect),r.settings[e].overlay&&(r.overlay[e].classList.add("custombox-overlay-close"),r.overlay[e].style.opacity&&(r.overlay[e].style.opacity=0),r.overlay[e].classList.remove("custombox-overlay-open"),r.main.classList.remove("custombox-container-open")),u.oldIE||u.oldMobile||!r.overlay[e])h();else{var n=function(){r.overlay[e].removeEventListener("transitionend",n);h()};r.overlay[e].addEventListener("transitionend",n,!1)}};h=function(){var f;if(r.settings.length===1&&(i.classList.remove("custombox-perspective"),i.classList.remove("custombox-open"),typeof r.scroll[e]!="undefined"&&n.scrollTo(0,r.scroll[e])),i.classList.remove("custombox-open-"+r.settings[e].overlayEffect),r.inline[e]&&(u.oldIE?(r.content[e].style.removeAttribute("width"),r.content[e].style.removeAttribute("display")):(r.content[e].style.removeProperty("width"),r.content[e].style.removeProperty("display")),r.display[e]&&(r.content[e].style.display="none"),r.inline[e].parentNode.replaceChild(r.content[e],r.inline[e])),r.main.classList.remove("custombox-container-"+r.settings[e].overlayEffect),r.wrapper[e].parentNode.removeChild(r.wrapper[e]),r.settings[e].overlay&&r.overlay[e].parentNode.removeChild(r.overlay[e]),typeof r.settings[e].close=="function"&&r.settings[e].close.call(),t.createEvent&&(f=t.createEvent("Event"),f.initEvent("custombox.close",!0,!0),t.dispatchEvent(f)),r.settings.length===1){for(var s=t.querySelectorAll(".custombox-container > *"),o=0,h=s.length;o<h;o++)document.body.insertBefore(s[o],r.main);r.main.parentNode&&r.main.parentNode.removeChild(r.main)}r.wrapper.splice(e,1);r.inline[e]&&r.inline.splice(e,1);r.content.splice(e,1);r.container.splice(e,1);r.modal.splice(e,1);r.overlay.splice(e,1);r.size.splice(e,1);r.settings.splice(e,1);r.scroll.splice(e,1)};u.modal.position.indexOf(r.settings[e].effect)>-1&&r.settings[e].animation.length>1&&(r.modal[e].classList.remove("custombox-modal-"+r.settings[e].effect+"-"+r.settings[e].animation[0]),r.modal[e].classList.add("custombox-modal-"+r.settings[e].effect+"-"+r.settings[e].animation[1].trim()));r.wrapper[e].classList.remove("custombox-modal-open");u.oldIE||u.oldMobile||u.overlay.together.indexOf(r.settings[e].overlayEffect)>-1?s():(c=function(){r.wrapper[e].removeEventListener("transitionend",c);s()},r.wrapper[e].addEventListener("transitionend",c,!1))},responsive:function(){u.oldIE&&(n.innerHeight=i.clientHeight);for(var t=0,e=r.container.length,f;t<e;t++){if(r.size[t]+60>=n.innerWidth)r.container[t].style.width="auto",r.container[t].style.marginLeft="5%",r.container[t].style.marginRight="5%",r.wrapper[r.item].style.width=n.innerWidth+"px";else{switch(r.settings[r.item].position[0].trim()){case"left":r.container[t].style.marginLeft=0;break;case"right":r.container[t].style.marginRight=0;break;default:r.container[t].style.marginLeft="auto";r.container[t].style.marginRight="auto"}r.container[t].style.width=r.size[t]+"px";r.wrapper[r.item].style.width="auto"}if(r.content[t].offsetHeight>=n.innerHeight)r.container[t].style.marginTop="5%",r.container[t].style.marginBottom="5%";else{switch(r.settings[r.item].position[1]){case"top":f=0;break;case"bottom":f=n.innerHeight-r.content[t].offsetHeight+"px";break;default:f=n.innerHeight/2-r.content[t].offsetHeight/2+"px"}r.container[t].style.marginTop=f}}},error:function(){alert("Error to load this target: "+r.settings[r.item].target)}},e={zIndex:function(){var i=0,t;if(isNaN(r.settings[r.item].zIndex))for(var u=0,f=document.getElementsByTagName("*"),e=f.length;u<e;u+=1)t=n.getComputedStyle(f[u]).getPropertyValue("z-index"),t&&(t=+t,t>i&&(i=t));else i=r.settings[r.item].zIndex;return i},extend:function(){for(var t,n=1,i=arguments.length;n<i;n++)for(t in arguments[n])arguments[n].hasOwnProperty(t)&&(arguments[0][t]=arguments[n][t]);return arguments[0]}};return{open:function(n){r.options=n;f.init()},close:function(n){f.close(n)}}}(window,document,document.documentElement);