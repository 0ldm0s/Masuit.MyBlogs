myApp.controller("dashboard",["$scope","$http","$timeout","$location",function(n,t,i,r){var u;n.loading();n.distinct=!0;var o=[],s=[],h=[],f=0,e=0,a=0,c=0,v=0,y=0,l=0;n.cpu={};n.memory={};n.isPush=n.isPush?n.isPush:!0;n.push="停止";n.connectWebsocket=function(){window.hub=(new signalR.HubConnectionBuilder).withUrl("/hubs").build();window.hub.start().then(()=>{window.hub.stream("Counter",5e3).subscribe({next:t=>{o.push([t.time,t.cpuLoad,t.memoryUsage]),f=t.cpuLoad,e=t.memoryUsage,n.cpu.CpuLoad=f,n.memory.MemoryUsage=e,h.push([t.time,t.diskRead,t.diskWrite]),a=t.diskRead,c=t.diskWrite,l=c,s.push([t.time,t.upload,t.download]),v=t.upload,y=t.download,n.$apply()},complete:()=>{console.log("done")},error:()=>{}})})};ifvisible.idle(function(){hub.stop()});ifvisible.blur(function(){hub.stop()});ifvisible.wakeup(function(){n.isPush&&r.url()==="/home"&&n.connectWebsocket()});t.post("/system/GetBaseInfo",null).then(function(t){var i=t.data;n.cpu=i.cpuInfo[0];n.cores=i.cpuInfo.length;n.memory=i.ramInfo;n.disk=i.diskInfo;n.osVersion=i.osVersion;n.netInfo=i.netInfo;n.RunningTime=i.runningTime;n.BootTime=i.bootTime});n.StopPush=function(){n.isPush?(hub.stop(),n.push="开始",n.isPush=!1):(n.connectWebsocket(),n.push="停止",n.isPush=!0)};n.ClearPerfCounter=function(){swal({title:"清除性能计数器缓存",text:"确定要清除性能计数器缓存吗？",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1}).then(function(){t.post("/system/ClearPerfCounter").then(function(){window.notie.alert({type:1,text:"性能计数器缓存清除完成！",time:4})},function(){window.notie.alert({type:3,text:"服务请求失败！",time:4});n.loadingDone()})},function(){}).catch(swal.noop)};n.connectWebsocket();$.post("/system/GetHistoryList",null,function(t){Highcharts.stockChart("cpu",{subtitle:{text:document.ontouchstart===undefined?"鼠标拖动可以进行缩放":"手势操作进行缩放"},chart:{zoomType:"x",backgroundColor:"transparent",animation:Highcharts.svg,events:{load:function(){var n=this.series[0],t=this.series[1],i=this.series[2];setInterval(function(){let r=o.pop();r&&(n.addPoint([r[0],r[1]],!0,!0),t.addPoint([r[0],r[2]],!0,!0),i.addPoint([r[0],r[3]],!0,!0))},2e3)},backgroundColor:"transparent"}},credits:{enabled:!1},boost:{useGPUTranslations:!0},plotOptions:{series:{showInNavigator:!0,marker:{enabled:!1}}},legend:{align:"right",verticalAlign:"top",floating:!0,x:-50,y:0},title:{text:"资源使用率"},xAxis:{type:"datetime",tickPixelInterval:150},yAxis:[{title:{text:"使用率（%）"},min:0,opposite:!1}],exporting:{enabled:!1},scrollbar:{enabled:!1},rangeSelector:{buttons:[{type:"minute",count:5,text:"5分钟"},{type:"minute",count:15,text:"15分钟"},{type:"minute",count:30,text:"30分钟"},{type:"hour",count:1,text:"1小时"},{type:"hour",count:2,text:"2小时"},{type:"hour",count:5,text:"5小时"},{type:"hour",count:12,text:"12小时"},{type:"day",count:1,text:"1天"},{type:"day",count:3,text:"3天"},{type:"all",text:"All"}],inputEnabled:!1,selected:1},tooltip:{formatter:function(){return"时间点：<b>"+Highcharts.dateFormat("%H:%M:%S",this.points[0].x)+'<\/b><br/><span style="color:'+Highcharts.getOptions().colors[0]+'">CPU使用率：<b>'+Highcharts.numberFormat(this.points[0].y,2)+'%<\/b><\/span><br/><span style="color:'+Highcharts.getOptions().colors[1]+'">内存使用率：<b>'+Highcharts.numberFormat(this.points[1].y,2)+"%<\/b><\/span><br/>"},crosshairs:!0,shared:!0},series:[{name:"CPU使用率",type:"spline",data:t.cpu,tooltip:{valueSuffix:" %"}},{name:"内存使用率",type:"spline",data:t.mem,tooltip:{valueSuffix:" %"}}]});Highcharts.stockChart("io",{subtitle:{text:document.ontouchstart===undefined?"鼠标拖动可以进行缩放":"手势操作进行缩放"},chart:{zoomType:"x",backgroundColor:"transparent",animation:Highcharts.svg,events:{load:function(){var n=this.series[0],t=this.series[1],i=this.series[2];setInterval(function(){let r=h.pop(),u=s.pop();r&&(n.addPoint([r[0],r[1]],!0,!0),t.addPoint([r[0],r[2]],!0,!0),i.addPoint([u[0],u[2]],!0,!0))},2e3)}}},boost:{useGPUTranslations:!0},credits:{enabled:!1},plotOptions:{series:{showInNavigator:!0,marker:{enabled:!1}}},legend:{align:"right",verticalAlign:"top",floating:!0,x:-50,y:0},title:{text:"网络状态 和 磁盘I/O"},rangeSelector:{buttons:[{type:"minute",count:5,text:"5分钟"},{type:"minute",count:15,text:"15分钟"},{type:"minute",count:30,text:"30分钟"},{type:"hour",count:1,text:"1小时"},{type:"hour",count:2,text:"2小时"},{type:"hour",count:5,text:"5小时"},{type:"hour",count:12,text:"12小时"},{type:"day",count:1,text:"1天"},{type:"day",count:3,text:"3天"},{type:"all",text:"All"}],inputEnabled:!1,selected:1},xAxis:{type:"datetime",tickPixelInterval:150},yAxis:[{title:{text:"磁盘I/O速率(KBps)"},min:0,opposite:!0},{title:{text:"网络速率(KBps)"},min:0,opposite:!1}],tooltip:{formatter:function(){return"时间点：<b>"+Highcharts.dateFormat("%H:%M:%S",this.points[0].x)+'<\/b><br/><span style="color:'+Highcharts.getOptions().colors[0]+'">磁盘读：<b>'+Highcharts.numberFormat(this.points[0].y,0)+'KBps<\/b><\/span><br/><span style="color:'+Highcharts.getOptions().colors[1]+'">磁盘写：<b>'+Highcharts.numberFormat(this.points[1].y,0)+'KBps<\/b><\/span><br/><span style="color:'+Highcharts.getOptions().colors[2]+'">网络上行：<b>'+Highcharts.numberFormat(this.points[2].y,0)+'KBps<\/b><\/span><br/><span style="color:'+Highcharts.getOptions().colors[3]+'">网络下行：<b>'+Highcharts.numberFormat(this.points[3].y,0)+"KBps<\/b><\/span><br/>"},crosshairs:!0,shared:!0},exporting:{enabled:!1},scrollbar:{enabled:!1},series:[{name:"磁盘读",type:"spline",data:t.read,yAxis:0,tooltip:{valueSuffix:"KBps"}},{name:"磁盘写",type:"spline",data:t.write,yAxis:0,tooltip:{valueSuffix:"KBps"}},{name:"网络上行",type:"spline",data:t.up,yAxis:1,tooltip:{valueSuffix:"KBps"}},{name:"网络下行",type:"spline",data:t.down,yAxis:1,tooltip:{valueSuffix:"KBps"}}]});n.loadingDone()});u={chart:{backgroundColor:"transparent",type:"solidgauge"},title:null,pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:!1},yAxis:{stops:[[.1,"#55BF3B"],[.5,"#DDDF0D"],[.9,"#DF5353"]],lineWidth:0,minorTickInterval:null,tickPixelInterval:400,tickWidth:0,title:{y:-70},labels:{y:16}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}}};$("#container-speed").highcharts(Highcharts.merge(u,{yAxis:{min:0,max:100,title:{text:"CPU使用率"}},boost:{useGPUTranslations:!0},credits:{enabled:!1},series:[{name:"CPU使用率",data:[0],dataLabels:{format:'<div style="text-align:center"><span style="font-size:25px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y:.2f}%<\/span><br/>'},tooltip:{valueSuffix:"%"}}]}));$("#container-rpm").highcharts(Highcharts.merge(u,{yAxis:{min:0,max:100,title:{text:"内存使用率"}},boost:{useGPUTranslations:!0},credits:{enabled:!1},series:[{name:"内存使用率",data:[0],dataLabels:{format:'<div style="text-align:center"><span style="font-size:25px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y:.1f}%<\/span><br/>'},tooltip:{valueSuffix:" %"}}]}));$("#container-io").highcharts(Highcharts.merge(u,{yAxis:{min:0,max:1e4,title:{text:"磁盘I/O"}},boost:{useGPUTranslations:!0},credits:{enabled:!1},series:[{name:"磁盘I/O",data:[1],dataLabels:{format:'<div style="text-align:center"><span style="font-size:25px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y:.0f}KBps<\/span><br/>'},tooltip:{valueSuffix:" KBps"}}]}));setInterval(function(){var n=$("#container-speed").highcharts(),t;n&&(t=n.series[0].points[0],t.update(f));n=$("#container-rpm").highcharts();n&&(t=n.series[0].points[0],t.update(e));n=$("#container-io").highcharts();n&&(t=n.series[0].points[0],t.update(l))},1e3)}]);