myApp.controller("links",["$scope","$http","NgTableParams",function(n,t,i){function f(n,t){return n.isEditing=!1,t.$setPristine(),r.tableTracker.untrack(n),_.findWhere(u,function(t){return t.id===n.id})}window.hub.stop();var r=this,u=[];n.loading();n.paginationConf={currentPage:n.currentPage?n.currentPage:1,itemsPerPage:10,pagesLength:25,perPageOptions:[1,5,10,15,20,30,40,50,100,200],rememberPerPage:"perPageItems",onChange:function(){r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)}};this.GetPageData=function(f,e){n.loading();t.post("/links/getpagedata",{page:f,size:e}).then(function(t){n.paginationConf.currentPage=f;n.paginationConf.totalItems=t.data.TotalCount;$("div[ng-table-pagination]").remove();r.tableParams=new i({count:5e4},{filterDelay:0,dataset:t.data.Data});u=angular.copy(t.data.Data);n.loadingDone()})};r.del=function(t){swal({title:"确认删除这条友情链接吗？",text:t.Name,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1}).then(function(){n.request("/links/delete",{id:t.Id},function(n){window.notie.alert({type:1,text:n.Message,time:4})});_.remove(r.tableParams.settings().dataset,function(n){return t===n});r.tableParams.reload().then(function(n){n.length===0&&r.tableParams.total()>0&&(r.tableParams.page(r.tableParams.page()-1),r.tableParams.reload())})},function(){}).catch(swal.noop)};r.cancel=function(n,t){var i=f(n,t);angular.extend(n,i)};r.save=function(t,i){swal({title:"确认修改"+t.Name+"地址为：",text:t.Url,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1}).then(function(){n.request("/links/edit",t,function(n){window.notie.alert({type:1,text:n.Message,time:4});var r=f(t,i);angular.extend(r,t)})},function(){}).catch(swal.noop)};n.add=function(){swal({title:"添加联系方式",html:'<div class="input-group"><span class="input-group-addon">链接名称<\/span><input id="title" class="form-control" autofocus placeholder="链接名称"><\/div><div class="input-group"><span class="input-group-addon">地址<\/span><input id="url" class="form-control" placeholder="地址"><\/div>',showCloseButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(t){n.request("/links/add",{Name:$("#title").val(),Url:$("#url").val()},function(n){t(n)})})}}).then(function(t){t&&(t.Success?(swal(t.Message,"","success"),r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)):swal(t.Message,"","error"))}).catch(swal.noop)};r.check=function(t){n.request("/links/check",{link:t},function(n){n.Success?window.notie.alert({type:1,text:n.Message,time:4}):swal(n.Message,"","error")})};n.toggleWhite=function(t){n.request("/links/ToggleWhitelist",{id:t.Id,state:t.Except},function(){r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)})};n.toggleState=function(t){n.request("/links/Toggle",{id:t.Id,state:t.Status==1},function(){r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)})};n.toggleRecommend=function(t){n.request("/links/ToggleRecommend",{id:t.Id,state:t.Recommend},function(){r.GetPageData(n.paginationConf.currentPage,n.paginationConf.itemsPerPage)})}}]);